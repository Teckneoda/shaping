# Top Jobs

## Overview

Top Jobs is a premium listing type that costs $25 for 30 days and gives job postings
prominent placement on the homepage.

![Screenshot 2025-12-11 at 1.30.29 PM.png](Top%20Jobs/Screenshot_2025-12-11_at_1.30.29_PM.png)

**Repositories Analyzed**:

- `m-ksl-jobs` - legacy jobs code
- `m-ksl-classifieds-api` - CAPI for listing model, payment and cost constants for comparison
- `m-ksl-classifieds` - Classifieds for featured ad components, spotlights and collection information
- 

## Data Model

```jsx
  {
    topJob: true,                    // Boolean flag
    topJobStart: ISODate("..."),     // When it became a Top Job
    topJobTime: ISODate("..."),      // Expiration date (start + 30 days)
  }
```

This feature is activated when purchased. A special flag is set on the listing `topJob = true`, `topJobStart=NOW`, `topJobTime=NOW+30days` and as soon as the current time passes the `topJobTime` the job is displayed in the premium section of the home page.

## Homepage Display

- **Dedicated Section:** ”Latest Top Jobs” section on homepage.
- **Location/Category Filtering:** Interactive header allows users to filter by location and category.
- **Layout:**

![Screenshot 2025-12-11 at 1.40.25 PM.png](Top%20Jobs/Screenshot_2025-12-11_at_1.40.25_PM.png)

- **Search:** Has distinct search section. Opening this section allows the user to search for “Top Jobs Only”

![Screenshot 2025-12-11 at 1.45.47 PM.png](Top%20Jobs/Screenshot_2025-12-11_at_1.45.47_PM.png)

# Classifieds - Current Capabilities

1. Featured Ads
    - Date-based purchasing
    - Has Calendar picker to select dates
    - Mixed into search results, no dedicated section
    - Dealers have packages which include featured ad allotments
2. Spotlights
    - Dealer/category-level promotion
    - Visual badge on search results, larger display format
    - Mixed into search results, no dedicated section

# Gaps for Feature Parity

1. Home page Real Estate
2. Time-Range Specification start/end range
3. Fixed Duration Pricing ($25 for 30 days)
4. Dedicated Search Facet

## Q & A

1. **What happens after you purchase a top job?**
    1. When a top job is purchased, three fields are set (in /site-api/namespaces/Schema/Schemas/Job.php:911-915):
    - topJob = true (boolean flag)
    - topJobStart = new UTCDateTime() (current timestamp - when it becomes active)
    - topJobTime = new UTCDateTime(new DateTime('+30 days')) (expiration time)
    
    The job immediately becomes active as a "top job" and appears in top job search results.
    
2. Does the ability to purchase it disappear until the topJob expiration time has passed?
    1. NO - I found no validation logic preventing re-purchase of a top job before expiration:
- The Cart/Calculator.php doesn't check if a topJob is already active
- The ValidateAllotments state only validates allotment availability, not active status
- If you purchase it again, it simply overwrites the existing topJobStart and topJobTime with new values
    
    This could be a bug or unintended behavior where users can repeatedly purchase and reset their top job duration.
    

 3. Why do we need a topJob start time (if it is actively a topJob as soon as it is purchased)?

The topJobStart field is used exclusively for SORTING purposes:

- In JobSearch.php:80-82: setSortByTopJobStart() sets sort to ['topJobStart' => 'desc']
- In IndexController.php:408: passes sortByTopJobStart: true to display top jobs
- This ensures newer top jobs appear first in the listing on the homepage

It's NOT used to determine whether a job is actively a top job.

 4. Why do we need the bool field if we could just query if the topJob expiration time exists and is in the future?

This is a REDUNDANCY/INCONSISTENCY issue in the codebase:

The boolean field appears to be legacy code. The actual logic is inconsistent:

- Entity method (Job.php:999): isTopJob() returns the boolean field
return (bool)$this->topJob;
- GraphQL API (JobType.php:842-846): Checks if expiration is in future
$topJobTime = formatByNamedMask("unixTimestamp", $job['topJobTime']);
return ((int) $topJobTime > $now);
- Search queries (JobSearch.php:254): Filters by expiration
'range' => ['topJobTime' => ['gte' => time()]]

The source of truth is actually topJobTime - the boolean field could theoretically be removed and replaced everywhere with a check: topJobTime exists AND topJobTime > now().